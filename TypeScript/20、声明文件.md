## 声明文件

虽然 TypeScript 已经逐渐进入主流，但是市面上大部分库还是以 JavaScript 为主

由于这些库没有像 TS 一样定义类型，因此我们需要一个声明文件来帮助库的使用者来获取库的类型提示

### 第三方 d.ts

Github 上有一个库 [DefinitelyTyped](https://github.com/DefinitelyTyped/DefinitelyTyped) 它定义了市面上主流的JavaScript 库的 d.ts

可以在 [TypeSearch](https://microsoft.github.io/TypeSearch/) 中搜索是否有需要的声明库

如安装 jQuery 的 d.ts：

    npm install @types/jquery --save-dev

在使用 jQuery 便有了提示：

![Alt text](imgs/20-01.png)

而当库不存在对应的声明库时，我们就需要为它书写对应的声明文件

### 什么是声明语句

假如我们想使用第三方库 jQuery，一种常见的方式是在 html 中通过 \<script> 标签引入，然后就可以在全局使用 $ 或 jQuery

    $('#foo');

    jQuery('#foo');

但是在 TypeScript 中，编译器并不能理解 $ 与 jQuery 是什么：

    jQuery('#foo');
    // Error: Cannot find name 'jQuery'

这时，我们需要使用 declare var 来定义它的类型：

    declare var jQuery:(selector: string) => any;

    jQuery('#foo');

上例中，declare var 并没有真正定义了一个变量，只是定义了**全局**变量 jQuery 的类型，仅仅用于编译时的检查，编译结果中删除

上方编译结果：

    jQuery('#foo');

### 什么是声明文件

通常我们会把声明语句放到一个单独的文件（jQuery.d.ts）

    // src/jQuery.d.ts
    declare var jQuery: (selector: string) => any;


    // src/doc-20-01.ts
    const a = jQuery('#foo');

**声明文件需以 .d.ts 为后缀**

一般来说，TS 会解析项目中所有的 *.ts 文件，当然也包括 .d.ts 结尾的文件

所以当我们将 jQuery.d.ts 放到项目中时，其他所有 *.ts 文件都可以获得 jQuery 的类型了

如果仍然无法解析，可以检查 **tsconfig.json** 中的 files、include 和 exclude 配置，确保包含了 jQuery.d.ts

### 书写声明文件的场景

前面介绍的是最简单的全局变量声明文件，而真正书写一个声明文件却有不同的场景的区别

一般库的使用场景主要有以下几种：

- 全局变量：通过 \<script> 标签引入第三方库，注入全局变量

- npm 包：通过 import foo from 'foo' 引入，ES6 模块规范

- UMD 库：即可以 \<script> 标签引入，也可以 import

- 直接扩展全局变量：通过 \<script> 标签引入后，改变一个全局变量的结构

- 在 npm 包或 UMD 库中扩展全局变量：引用 npm 或 umd 库后，改变一个全局变量的结构

- 模块插件：通过 \<script> 或 import 导入后，改变另一个模块结构

### 全局变量

全局变量是最简单的一种场景，前面声明文件示例中就是 \<script> 标签引入 jQuery，注入全局变量 $ 或 jQuery

全局变量的声明文件主要有以下几种语法：

- declare var 声明全局变量

- declare function 声明全局方法

- declare class 声明全局类

- declare enum 声明全局枚举类型

- declare namespace 声明全局对象（含有子属性）

- interface、type 声明全局类型

#### declare var

declare var 可以用来定义一个全局变量的类型

与其类似的，还有 declare let 与 declare const

    // src/jQuery.d.ts
    declare let jQuery: (selector: string) => any;

    // src/doc-20-01.ts
    jQuery('#foo');
    jQuery = function(selector) {
        return document.querySelector(selector);
    }




