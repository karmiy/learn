<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap.min.css"
        integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <style>
        .wrap {
            padding: 30px;
        }

        .mt-3 {
            margin-top: 30px;
        }
    </style>
</head>

<body>
</body>
<script src="https://cdn.bootcdn.net/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/js/bootstrap.min.js"
    integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa"
    crossorigin="anonymous"></script>
<script>
    const plugin = {
        sign() {
            console.log('开始文件扫描');
        },
        pause() {
            console.log('暂停文件上传');
        },
        uploading() {
            console.log('开始文件上传');
        },
        del() {
            console.log('删除文件上传');
        },
        done() {
            console.log('文件上传完成');
        },
    };

    class Upload {
        constructor(fileName) {
            this.plugin = plugin;
            this.fileName = fileName;
            this.dom = null;
            this.button_1 = null;
            this.button_2 = null;
            this.state = 'sign'; // 初始状态
        }
        init() {
            this.dom = document.createElement('div');
            this.dom.innerHTML =
                `<span>文件名称: ${this.fileName}</span>
                <button>扫描中</button>
                <button>删除</button>`;
            document.body.appendChild(this.dom);
            const buttons = this.dom.querySelectorAll('button');
            this.button_1 = buttons[0];
            this.button_2 = buttons[1];

            this.bindEvent();
        }
        bindEvent() {
            this.button_1.onclick = () => {
                if (this.state === 'sign') { // 扫描中，操作无效
                    console.log('扫描中，点击无效...');
                } else if (this.state === 'uploading') { // 上传中 => 暂停
                    this.changeState('pause');
                } else if (this.state === 'pause') { // 暂停 => 上传中
                    this.changeState('uploading');
                } else if (this.state === 'done') { // 上传完成，操作无效
                    console.log('文件已完成上传, 点击无效');
                } else if (this.state === 'error') { // 上传失败，操作无效
                    console.log('文件上传失败, 点击无效');
                }
            }
            this.button_2.onclick = () => {
                if (this.state === 'done' || this.state === 'error' || this.state === 'pause') {
                    // 上传完成、上传失败和暂停状态下可以删除
                    this.changeState('del');
                } else if (this.state === 'sign') { // 扫描中，删除无效
                    console.log('文件正在扫描中，不能删除');
                } else if (this.state === 'uploading') { // 上传中，删除无效
                    console.log('文件正在上传中，不能删除');
                }
            };
        }
        changeState(state) {
            switch (state) {
                case 'sign':
                    this.plugin.sign();
                    this.button_1.innerHTML = '扫描中，任何操作无效';
                    break;
                case 'uploading':
                    this.plugin.uploading();
                    this.button_1.innerHTML = '正在上传，点击暂停';
                    break;
                case 'pause':
                    this.plugin.pause();
                    this.button_1.innerHTML = '已暂停，点击继续上传';
                    break;
                case 'done':
                    this.plugin.done();
                    this.button_1.innerHTML = '上传完成';
                    break;
                case 'error':
                    this.button_1.innerHTML = '上传失败';
                    break;
                case 'del':
                    this.plugin.del();
                    this.dom.parentNode.removeChild(this.dom);
                    console.log('删除完成');
                    break;
            }
            this.state = state;
        }
    }

    const uploadObj = new Upload('JavaScript 从入门到精通');
    uploadObj.init();

    setTimeout(() => { // 假设 3s 后扫描完成，开始上传
        uploadObj.changeState('uploading');
    }, 3000);

    setTimeout(() => { // 假设 6s 后上传完成
        uploadObj.changeState('done');
    }, 6000);
</script>

</html>